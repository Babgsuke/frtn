const fs = require("fs");

const FILE_PATH = "./storage.json";

// Data utama yang disimpan
let data = {
	userStep: {},
	userData: {},
	lastMesage_id: {},
	culdown()
};

// ğŸ”¹ Fungsi untuk memuat data dari file
function loadStorage() {
	if (fs.existsSync(FILE_PATH)) {
		try {
			const raw = fs.readFileSync(FILE_PATH);
			data = JSON.parse(raw);
			console.log("âœ… Storage berhasil dimuat dari file.");
		} catch (err) {
			console.error("âš ï¸ Gagal membaca storage.json:", err);
		}
	} else {
		console.log("â„¹ï¸ Tidak ada file storage.json, membuat baru nanti.");
	}
}

// ğŸ”¹ Fungsi untuk menyimpan data ke file
function saveStorage() {
	try {
		fs.writeFileSync(FILE_PATH, JSON.stringify(data, null, 2));
		console.log("ğŸ’¾ Storage berhasil disimpan.");
	} catch (err) {
		console.error("âŒ Gagal menyimpan storage.json:", err);
	}
}

// ğŸ”¹ Getter dan Setter agar mudah digunakan
function setUserStep(userId, step) {
	data.userStep[userId] = step;
	saveStorage();
}

function setJeda(userId, jeda) {
	data.userStep[userId] = step;
	saveStorage();
}

function getUserStep() {
	return data.userStep || null;
}

function clearUserStep(userId) {
	delete data.userStep[userId];
	saveStorage();
}

function getlastMesage_id() {
	return data.lastMesage_id || null;
}

function setlastMesage_id(userId, mesage_id) {
	data.lastMesage_id[userId] = mesage_id;
	saveStorage();
}

function clearlastMesage_id(userId) {
	delete data.lastMesage_id[userId];
	saveStorage();
}
module.exports = {
	loadStorage,
	saveStorage,
	setUserStep,
	getUserStep,
	clearUserStep,
	getlastMesage_id,
	setlastMesage_id,
	clearlastMesage_id
};
